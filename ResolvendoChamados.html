<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="sidebars/bootstrap.min.css">
    <title>Resolvendo Chamados</title>
    <style>
        .container {
            margin-top: 20px;
            border: solid 1px black;
            border-radius: 12px;
        }

        .table {
            width: 80%;
            margin: auto;
        }

        .table-heading {
            background-color: #00a383;
            color: white;
        }
    </style>
</head>

<body onload="selectInicial()">
    <div class="container container-fluid">
        <h1>Resolvendo Chamados</h1>
        <div class="container container-fluid">
            <h2>Novos chamados</h2>
            <table class="table table-hover table-striped" >
                <thead class="table-heading table-dark">
                    <td>ID</td>
                    <td>Assunto</td>
                    <td>Data</td>
                    <td>Prioridade</td>
                    <td>Dias em aberto</td>
                    <td>Status</td>
                </thead>
                <tbody id="novos">
                    <td>1</td>
                    <td>Placeholder</td>
                    <td>18/09/2023</td>
                    <td>Alta</td>
                    <td>3</td>
                    <td>Aberto</td>
                    <td><img src="Icones Site/iconeplus.png" width="20px" alt=""></td>
                </tbody>
            </table>
        </div>
        <div class="container container-fluid">
            <h2>Chamados que seu usuário está resolvendo</h2>
            <table class="table table-hover table-striped" >
                <thead class="table-heading">
                    <td>ID</td>
                    <td>Assunto</td>
                    <td>Data de Abertura</td>
                    <td>Prioridade</td>
                    <td>Status</td>
                </thead>
                <tbody id="resolvendo">
                    <td>2</td>
                    <td>Placeholder</td>
                    <td>18/09/2023</td>
                    <td>Média</td>
                    <td>Em andamento</td>
                </tbody>
            </table>
        </div>
        <div class="container container-fluid">
            <h2>Todos os chamados</h2>
            <table class="table table-hover table-striped" id="todos">
                <thead class="table-heading">
                    <td>ID</td>
                    <td>Assunto</td>
                    <td>Data de Abertura</td>
                    <td>Prioridade</td>
                    <td>Status</td>
                </thead>
                <tbody>
                    <td>3</td>
                    <td>Placeholder</td>
                    <td>18/09/2023</td>
                    <td>Baixa</td>
                    <td>Aberto</td>
                </tbody>
            </table>
        </div>
    </div>

</body>
<script>
    function selectInicial() {
        var dados = 'selectChamados=1';
        connection(dados);
    }
    function connection(dados) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", 'ResolvendoChamados.php');
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var resposta = xhr.responseText;
                unParse(resposta);
                // console.log(resposta);

            }
        }
        xhr.send(dados);
    }
    function unParse(dados) {
        var dados = JSON.parse(dados);
        console.log(dados);

        var novos = document.getElementById('novos');
        var resolvendo = document.getElementById('resolvendo');
        var todos = document.getElementById('todos');
        const usuario = dados[0].responsavel;
        console.log(dados[0])

        dados.forEach(element => {
            if(element.responsavel == null){
                var linha = document.createElement('tr');
                var id = document.createElement('td');
                var assunto = document.createElement('td');
                var data = document.createElement('td');
                var prioridade = document.createElement('td');
                var dias = document.createElement('td');
                var status = document.createElement('td');
                var opt = document.createElement('td');
                var img = document.createElement('img');
                img.setAttribute('src', 'Icones Site/iconeplus.png');
                img.setAttribute('width', '20px');
                img.setAttribute('alt', '');
                opt.appendChild(img);
                id.innerHTML = element.IDChamado;
                assunto.innerHTML = element.assunto;
                data.innerHTML = element.dataAbertura;
                prioridade.innerHTML = element.prioridade;
                dias.innerHTML = element.dias;
                status.innerHTML = element.status_chamado;
                // img.innerHTML = img;
                linha.appendChild(id);
                linha.appendChild(assunto);
                linha.appendChild(data);
                linha.appendChild(prioridade);
                linha.appendChild(dias);
                linha.appendChild(status);
                linha.appendChild(opt);
                novos.appendChild(linha);
                linha.addEventListener('click', function(){
                    window.location.href = 'DetalhandoChamado.html?IDChamado='+element.IDChamado;
                })
            }
            else if(element.responsavel == usuario && element.status == '2' || element.status == '3'){
                var linha = document.createElement('tr');
                var id = document.createElement('td');
                var assunto = document.createElement('td');
                var data = document.createElement('td');
                var prioridade = document.createElement('td');
                var status = document.createElement('td');
                id.innerHTML = element.IDChamado;
                assunto.innerHTML = element.assunto;
                data.innerHTML = element.dataAbertura;
                prioridade.innerHTML = element.prioridade;
                status.innerHTML = element.status;
                linha.appendChild(id);
                linha.appendChild(assunto);
                linha.appendChild(data);
                linha.appendChild(prioridade);
                linha.appendChild(status);
                resolvendo.appendChild(linha);
            }
            // console.log(element);
        });
            
        
    }
</script>

</html>
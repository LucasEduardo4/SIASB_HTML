<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abrindo Chamado</title>
  <script src="/siasb_html/flowSite/verificaSessao.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="sidebars/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- //para o popup -->



  <style>
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      /* height: 100vh; */
      padding: 50px;
      max-width: 100%;
      font-weight: 700;
      /* background: none; */

      /* background-image: url('https://e7.pngegg.com/pngimages/668/950/png-transparent-water-and-water-droplets-background.png');
      background-repeat: repeat;
      background-size:cover ; */

    }

    .div-superior {
      width: 2000px;
      min-width: 800px;
      background-color: #ffffff;
      padding: 20px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);


    }

    .logo {
      /* position: absolute; */
      width: 40px;
      height: 40px;
      left: 78px;
      margin: 0 auto;
      background-color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      /* z-index: 2; */
      top: 35px;
    }

    .logo img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 6px;
    }

    .div-inferior {
      width: 1200px;
      min-width: 700px;
      background-color: #ffffff;
      padding: 20px;
      /* z-index: 1; */
      margin-bottom: 50px;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);

    }

    .div-azul {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      min-width: 600px;

      /* position: absolute; */
      background-color: #00a383;
      color: #ffffff;
      padding: 15px;
      border-radius: 5px;
      /* z-index: 2; */
      /* width: 1028px; */
      width: 100%;
      top: 280px;
      text-align: center;
      font-size: 15px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);


    }



    .form {
      margin: 20px;
    }


    /* REALIZANDO ALTERAÇÃO DA DIV DOS CAMPOS DE CIMA DO FORMULÁRO */
    .top-div {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    /* ================================================================ */

    .hardware-div,
    .assunto-div {
      flex-basis: 48%;
    }

    .bottom-div {
      display: flex;
      justify-content: space-between;
    }

    .descricao-div {
      flex-basis: 60%;

    }

    .upload-div {
      width: 100%;
      padding: 10px;
      border-width: 2px;
      border-style: dotted;
      border-color: black;
      border-radius: 5px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;

    }

    textarea {
      width: 81%;
      padding: 100px;
      border-radius: 7px;

    }

    input,
    select {
      width: 100%;
      padding: 10px;
      border-radius: 7px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;

    }

    #descricao {
      padding: 10px 20px;
      height: 200px;
      width: 100%;
      min-width: 500px;
    }

    .my-custom-icon {
      font-size: 200px;
      /* Defina o tamanho desejado */
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -moz-appearance: textfield;
      /* Remove as setas no Firefox */
    }
  

  </style>



  <style>

  /* Estilo para o rótulo personalizado */
  input[type="radio"] {
      display: none; /* Oculta o input padrão */
    }
  
    /* Estilo para o rótulo personalizado */
    .custom-radio {
      position: relative;
      padding-left: 30px; /* Espaço para o ícone do radio */
      cursor: pointer;
      /* margin-left: 50px; */

      
    }
  
    /* Ícone do radio personalizado */
    .custom-radio:before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      width: 20px;
      height: 20px;
      border: 2px solid #40a383;
      border-radius: 50%;
    }
  
    /* Estilização quando o radio está selecionado */
    input[type="radio"]:checked + .custom-radio:before {
      background-color: #40a383;
    }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        button {
            background-color: #40a383;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        h2 {
          font-size: 16px;
          padding-top: 20px;
          padding-bottom: 20px;
          font-family:Verdana, Geneva, Tahoma, sans-serif;
          font-weight: 900;
        }

        .dropdown {
        border: 2px solid #40a383;
        max-height: 150px;
        overflow-y: auto;
        
        
        }

        .item {
        padding: 8px;
        cursor: pointer;
        }

        .item:hover {
        background-color: #f0f0f0;
        }

</style>

</head>

<body style="background: none;">

  <div class="container">
    <div style="border-radius: 5px;" class="div-superior">
      <!-- <div style="border-radius: 10px;" class="logo">
        <img src="..\SIASB_HTML\Icones Site\TELEFONE.png" alt="saaeb barretos" width="40" height="40">
      </div> -->
      <h2 style="color: #40a383; font-size: 25px;">SISTEMA DE CHAMADO SAAEB BARRETOS</h2>
      <p>
        Aqui você pode abrir um chamado para solucionar algum problema que você está tendo no seu setor.
      </p>
      <!-- Conteúdo adicional da div superior -->
    </div>
  </div>

  <div class="container">
    <div style="border-radius: 5px; " class="div-inferior">
      <div style="border: 2px; padding-bottom: 20px;" class="div-azul">DESCREVA ABAIXO SUA SOLICITAÇÃO</div>
      
      <form class="blue-theme-form" enctype="multipart/form-data">

        <!-- =================== ================================= -->

        <div class="step" id="step-0">
                
          <label for="motivo">POR QUAL MOTIVO ESSA PESSOA NÃO PODE ABRIR O CHAMADO?</label>
          <input type="text" id="teste" name="teste" required>


                <button onclick="checkAnswer()" style="padding-top: 10px; padding-bottom: 10px; margin-top: 20px; width: 100%; border-radius: 16px;" onclick="nextStep(0)" >Próxima Etapa</button>
      
        </div>

        <div class="step active" id="step-1">
                
          <h2>VOCÊ DESEJA ABRIR UM CHAMADO PARA VOCÊ OU PARA TERCEIROS ? </h2>

                <input  type="radio" id="resposta-sim" name="resposta" value="sim">
                <label class="custom-radio" style="font-weight: 500; padding-left: 30px; font-size: 14px;" for="resposta-sim"> PARA O COMPANHEIRO DE TRABALHO</label>

                <input type="radio" id="resposta-nao" name="resposta" value="nao">
                <label class="custom-radio" style="font-weight: 500; padding-left: 30px; font-size: 14px;" for="resposta-nao">PARA EU MESMO</label>


                <button onclick="checkAnswer()" style="padding-top: 10px; padding-bottom: 10px; margin-top: 20px; width: 100%; border-radius: 16px;" onclick="nextStep(1)" >Próxima Etapa</button>
      
        </div>
      
        <div class="step" id="step-2">
          <h2>VOCÊ IRÁ ABRIR UM CHAMADO PARA OUTRO FUNCIONÁRIO</h2>
          
          <label for="motivo">POR QUAL MOTIVO ESSA PESSOA NÃO PODE ABRIR O CHAMADO?</label>
          <input type="text" id="motivo" name="motivo" required>
          
          <label  for="terceiros">QUAL O NOME DO FUNCIONÁRIO?</label>
          <input type="text" id="terceiros" name="terceiros" required>
          <div id="sugestoes"></div>
          
          <button style="padding-top: 10px; padding-bottom: 10px; margin-top: 20px; width: 100%; border-radius: 16px;" onclick="validarCampos()" id="next" disabled>Próxima Etapa</button>
        </div>
        

      <div class="step" id="step-3">
          
        <div style="margin-top: 30px;" class="top-div">
          <div class="assunto-div">
            <label for="assunto">Assunto:</label>
            <input placeholder="Digite o assunto" type="text" id="assunto" name="assunto" required>
          </div>
          <div class="hardware-div">
            <br>
            <label for="sti_ID">STI_ID:</label>
            <input style="width: 13%;" type="number" id="sti_ID" name="sti_ID" maxlength="4" size="4"
              onkeyup="verificaTamanho(this, 4, 'descricao')" onblur="verificaEquipamento()" max="9999" required>

            <label for="nomeEquipamento"> Equipamento:</label>
            <input type="text" id="nomeEquipamento" disabled value="" style="width: 40%;" required>
            <h2 style="margin-left: 10px; display: none;" id="plusCircle" title="Cadastrar equipamento"><i
            
              id="cadastroIcone" onclick='handleCadastro(this, 0)' class="bi bi-plus-circle-fill"></i></h2>
          </div>
        </div>
          <button style="padding-top: 10px; padding-bottom: 10px; margin-top: 20px; width: 100%; border-radius: 16px;" onclick="validarCampos2()">Próxima Etapa</button>
     
      </div>

      <div class="step" id="step-4">
          
        <div style="margin-top: 0px;" class="descricao-div">
          <label style="padding-top: 20px;" for="descricao">Descrição:</label>
          <textarea placeholder="Descreva aqui o seu problema..." id="descricao" name="descricao" rows="4"></textarea>
        </div>

        <div style="margin-top: 30px;" class="upload-div">
          <label for="imagem">Envie uma imagem do problema:</label>
          <input type="file" id="imagem" multiple name="imagem" required>
        </div>
        <div id="erromsg" class="container p-3 mt-3 bg-danger" style="border-radius: 16px; width: 70%; display: none;">
          <p>Falta preencher algum campo acima, Verifique novamente</p>
        </div>
        <button style="padding-top: 10px; padding-bottom: 10px; margin-top: 20px; width: 100%; border-radius: 16px;"
         onclick="enviarFormulario()">ENVIAR</button>     
      </div>

      <!-- ===================================================================== -->

      </form>
    </div>
  </div>

  <!-- PASSANDO OS DADOS PARA O JAVASCRIPT -->
  <script src="sidebars/bootstrap.bundle.min.js"></script>
  <script>

    function verificaTamanho(inputElement, tamanho, proximoCampo) {
      if (inputElement.value.length > tamanho) {
        inputElement.value = inputElement.value.slice(0, tamanho);
      }
      if (inputElement.value.length === tamanho) {
        document.getElementById(proximoCampo).focus();
      }
    }

    function enviarFormulario() {
      var assunto = document.getElementById("assunto").value;
      var descricao = document.getElementById("descricao").value;
      var imagemInput = document.getElementById("imagem");
      var sti_ID = document.getElementById("sti_ID").value; 
      var terceiros = document.getElementById("terceiros").value;
      var motivo = document.getElementById("motivo").value;

      if (assunto === '' || descricao === '' || sti_ID === '') {
        document.getElementById("erromsg").style.display = 'flex';
      }

      var formData = new FormData();
      formData.append("assunto", assunto);
      formData.append("descricao", descricao);
      formData.append("sti_ID", sti_ID);
      formData.append("terceiros", terceiros);
      formData.append("motivo", motivo);
      if (imagemInput.files.length > 0) {
        // Adicione todos os arquivos selecionados ao FormData
        for (var i = 0; i < imagemInput.files.length; i++) {
          formData.append("imagem[]", imagemInput.files[i]);
        }
      }

      
      
      var xhr = new XMLHttpRequest();
      xhr.open("POST", "AbrindoChamado.php", true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            console.log(xhr.responseText);
            exibirPopup();
          } else {
            // Lida com erros aqui, se necessário
          }
        }
      };

      // Envie o FormData com os dados do formulário
      xhr.send(formData);

    }




    function exibirPopup() {
      Swal.fire({
        icon: 'success',
        title: 'Confirmação',
        text: 'O chamado foi aberto, aguarde até visualizarmos sua solicitação. Você será notificado por e-mail quando houver alteração no status.',
        showConfirmButton: true,
        confirmButtonText: 'Entendi',
        timer: 3000,
        timerProgressBar: true, // Mostrar barra de progresso do timer
      }).then((result) => {
        // Após o tempo do timer, redireciona para a página desejada
        window.location.href = 'VendoChamados.html';
        // Verificar se o botão foi clicado
        if (result.isConfirmed) {
          // Redirecionar para a página desejada
          window.location.href = 'VendoChamados.html';
        }
      });
    }

    function handleCadastro(icone, response) {
      var nomeEquipamento = document.getElementById("nomeEquipamento");

      if (response === 'Equipamento nao encontrado') {
        nomeEquipamento.placeholder = 'Código inválido';
        nomeEquipamento.value = '';
      } else if (response !== 'Equipamento nao encontrado') {
        nomeEquipamento.placeholder = '';
      }
    }

    function verificaEquipamento() {
      var sti_ID = document.getElementById("sti_ID").value;
      // var equipamento = document.getElementById("nomeEquipamento");

      connection('sti_ID=' + sti_ID, 1, 'AbrindoChamado.php');
    }

    function connection(data, output, file) {
      var nomeEquipamento = document.getElementById("nomeEquipamento");

      var xhr = new XMLHttpRequest();
      xhr.open("POST", file, true);
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          if (output == 1) {
            var response = xhr.responseText;
            // console.log(response);
            nomeEquipamento.value = response;
            // foo(response);
            handleCadastro(document.getElementById("cadastroIcone") || document.getElementById("cadastroReady"), response);
          }
        }
      }
      xhr.send(data);
    }
  </script>






  <!-- <=============================================================================================================================> -->

  <script>
    let currentStep = 1;

    function nextStep(step) {

        if (currentStep == 1 )
        {
            document.getElementById(`step-${1}`).classList.remove('active');
            currentStep = step + 1;
        document.getElementById(`step-${currentStep}`).classList.add('active');
        }

        if (currentStep == 2 )
        {
            document.getElementById(`step-${2}`).classList.remove('active');
            currentStep = step + 1;
        document.getElementById(`step-${currentStep}`).classList.add('active');
        }

        if (currentStep == 3 )
        {
            document.getElementById(`step-${3}`).classList.remove('active');
            currentStep = step + 1;
        document.getElementById(`step-${currentStep}`).classList.add('active');
        }

        if (currentStep == 4 )
        {
            document.getElementById(`step-${4}`).classList.remove('active');
            currentStep = step + 1;
        document.getElementById(`step-${currentStep}`).classList.add('active');
        }

        // ETAPA FANTASMA PARA REALIZAR O PROCEDIMENTO DO ENVIO DO FORMULARIO
        if (currentStep == 0 )
        {
            document.getElementById(`step-${0}`).classList.remove('active');
            currentStep = step + 1;
        document.getElementById(`step-${currentStep}`).classList.add('active');
        }


    }

        // Captura o evento de pressionar uma tecla no campo de entrada
        document.getElementById("assunto").addEventListener("keydown", function(event) {
            // Verifica se a tecla pressionada é o "Enter"
            if (event.key === "Enter") {
                // Impede o envio automático do formulário
                event.preventDefault();
                // Nada acontece aqui, pois nenhum código foi adicionado
            }
        });

        document.getElementById("sti_ID").addEventListener("keydown", function(event) {
            // Verifica se a tecla pressionada é o "Enter"
            if (event.key === "Enter") {
                // Impede o envio automático do formulário
                event.preventDefault();
                // Nada acontece aqui, pois nenhum código foi adicionado
            }
        });


    // FAZER MEU PRÓXIMO MÉTODO PARA MUDAR DE ABA (REDONDA)
    // function changeStep(step) {
    //     document.getElementById(`step-${currentStep}`).classList.remove('active');
    //     document.getElementById(`tab-${currentStep}`).classList.remove('active');
    //     currentStep = step;
    //     document.getElementById(`step-${currentStep}`).classList.add('active');
    //     document.getElementById(`tab-${currentStep}`).classList.add('active');
    // }

    function checkAnswer() {
    const resposta = document.querySelector('input[name="resposta"]:checked').value;

    if (resposta === "sim") {
        nextStep(1); // Vá para a próxima etapa se a resposta for "sim"
    } 
    
    if (resposta === "nao") {
        nextStep(2); // Pule para a etapa desejada se a resposta for "não"
    }
    
}


function validarCampos() {
  var motivo = document.getElementById("motivo").value;
  var terceiros = document.getElementById("terceiros").value;
  
  if (motivo === "" || terceiros === "") {
    alert("Por favor, preencha todos os campos antes de avançar.");
  } else {

    nextStep(2);
  }
}

function validarCampos2() {

  var assunto = document.getElementById("assunto").value;

  if (assunto === "") {
    alert("Por favor, preencha todos os campos antes de avançar.");
  } else {
    nextStep(3);
  }
}

    // function checkAge() {
    //     const idade = parseInt(document.getElementById('idade').value);
    //     if (idade < 18) {
    //         nextStep(1); // Se a idade for menor que 18, vá para a Etapa 4
    //     }
    //     if (idade > 18) {
    //         nextStep(2); // Caso contrário, vá para a Etapa 5
    //     }
    // }

    document.addEventListener("DOMContentLoaded", function () {
  const inputterceiros = document.getElementById("terceiros");
  const sugestoes = document.getElementById("sugestoes");
  const nextButton = document.getElementById("next"); // Botão de envio

  inputterceiros.addEventListener("input", function () {
    const termo = inputterceiros.value;

    if (termo.length >= 2) {
      fetch(`buscar_nomes.php?termo=${termo}`)
        .then((response) => response.json())
        .then((data) => {
          sugestoes.innerHTML = ""; // Limpe as sugestões existentes

          const dropdown = document.createElement("div");
          dropdown.classList.add("dropdown");

          data.forEach((nome) => {
            const sugestao = document.createElement("div");
            sugestao.classList.add("item");
            sugestao.textContent = nome;
            sugestao.addEventListener("click", function () {
              inputterceiros.value = nome;
              sugestoes.innerHTML = "";
              nextButton.disabled = false; // Habilita o botão quando uma sugestão é selecionada
            });
            dropdown.appendChild(sugestao);
          });

          sugestoes.appendChild(dropdown);
        })
        .catch((error) => {
          console.error(error);
        });
    } else {
      sugestoes.innerHTML = "";
      nextButton.disabled = true; // Desabilita o botão quando o termo é muito curto
    }
  });
});


    document.getElementById('step-form').addEventListener('submit', function (e) {
        e.preventDefault();
        alert('Formulário enviado com sucesso!');
    });
</script>


<!-- ===================================================================================================================================== -->
</body>

</html>
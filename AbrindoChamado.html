<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abrindo Chamado</title>
  <script src="/siasb_html/flowSite/verificaSessao.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="sidebars/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- //para o popup -->



  <style>
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      /* height: 100vh; */
      padding: 50px;
      max-width: 100%;
      /* background: none; */

      /* background-image: url('https://e7.pngegg.com/pngimages/668/950/png-transparent-water-and-water-droplets-background.png');
      background-repeat: repeat;
      background-size:cover ; */

    }

    .div-superior {
      width: 2000px;
      min-width: 800px;
      background-color: #ffffff;
      padding: 20px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);


    }

    .logo {
      /* position: absolute; */
      width: 40px;
      height: 40px;
      left: 78px;
      margin: 0 auto;
      background-color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      /* z-index: 2; */
      top: 35px;
    }

    .logo img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 6px;
    }

    .div-inferior {
      width: 1200px;
      min-width: 700px;
      background-color: #ffffff;
      padding: 20px;
      /* z-index: 1; */
      margin-bottom: 50px;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);

    }

    .div-azul {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      min-width: 600px;

      /* position: absolute; */
      background-color: #00a383;
      color: #ffffff;
      padding: 15px;
      border-radius: 5px;
      /* z-index: 2; */
      /* width: 1028px; */
      width: 100%;
      top: 280px;
      text-align: center;
      font-size: 15px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);


    }



    .form {
      margin: 20px;
    }


    /* REALIZANDO ALTERAÇÃO DA DIV DOS CAMPOS DE CIMA DO FORMULÁRO */
    .top-div {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    /* ================================================================ */

    .hardware-div,
    .assunto-div {
      flex-basis: 48%;
    }

    .bottom-div {
      display: flex;
      justify-content: space-between;
    }

    .descricao-div {
      flex-basis: 60%;

    }

    .upload-div {
      width: 100%;
      padding: 10px;
      border-width: 2px;
      border-style: dotted;
      border-color: black;
      border-radius: 5px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;

    }

    textarea {
      width: 81%;
      padding: 100px;
      border-radius: 7px;

    }

    input,
    select {
      width: 100%;
      padding: 10px;
      border-radius: 7px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;

    }

    #descricao {
      padding: 10px 20px;
      height: 200px;
      width: 100%;
      min-width: 500px;
    }

    .my-custom-icon {
      font-size: 200px;
      /* Defina o tamanho desejado */
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -moz-appearance: textfield;
      /* Remove as setas no Firefox */
    }
  </style>

</head>

<body style="background: none;">

  <div class="container">
    <div style="border-radius: 5px;" class="div-superior">
      <!-- <div style="border-radius: 10px;" class="logo">
        <img src="..\SIASB_HTML\Icones Site\TELEFONE.png" alt="saaeb barretos" width="40" height="40">
      </div> -->
      <h2 style="color: #000000;">SISTEMA DE CHAMADO SAAEB BARRETOS</h2>
      <p>
        Aqui você pode abrir um chamado para solucionar algum problema que você está tendo no seu setor.
      </p>
      <!-- Conteúdo adicional da div superior -->
    </div>
  </div>

  <div class="container">
    <div style="border-radius: 5px; " class="div-inferior">
      <div style="border: 2px;" class="div-azul">DESCREVA ABAIXO SUA SOLICITAÇÃO</div>
      <!-- Conteúdo adicional da div inferior -->
      <form class="blue-theme-form" enctype="multipart/form-data">

        <div style="margin-top: 30px;" class="top-div">
          <div class="assunto-div">
            <label for="assunto">Assunto:</label>
            <input placeholder="Digite o assunto" type="text" id="assunto" name="assunto">
          </div>
          <div class="hardware-div">
            <br>
            <label for="stiID">STI_ID:</label>
            <input style="width: 13%;" type="number" id="stiID" name="stiID" maxlength="4" size="4"
              onkeyup="verificaTamanho(this, 4, 'descricao')" onblur="verificaEquipamento()" max="9999">
            <label for="nomeEquipamento"> Equipamento:</label>
            <input type="text" id="nomeEquipamento" disabled value="" style="width: 40%;">
            <h2 style="margin-left: 10px; display: none;" id="plusCircle" title="Cadastrar equipamento"><i
                id="cadastroIcone" onclick='handleCadastro(this, 0)' class="bi bi-plus-circle-fill"></i></h2>
          </div>
        </div>

        <div style="margin-top: 0px;" class="descricao-div">
          <label for="descricao">Descrição:</label>
          <textarea placeholder="Descreva aqui o seu problema..." id="descricao" name="descricao" rows="4"></textarea>
        </div>

        <div style="margin-top: 30px;" class="upload-div">
          <label for="imagem">Envie uma imagem do problema:</label>
          <input type="file" id="imagem" name="imagem">
        </div>
        <div id="erromsg" class="container p-3 mt-3 bg-danger" style="border-radius: 16px; width: 70%; display: none;">
          <p>Falta preencher algum campo acima, Verifique novamente</p>
        </div>

      </form>
      <button style="padding-top: 10px; padding-bottom: 10px; margin-top: 20px; width: 100%; border-radius: 16px;"
        class="btn btn-success" onclick="enviarFormulario()">ENVIAR</button>
    </div>
  </div>

  <!-- PASSANDO OS DADOS PARA O JAVASCRIPT -->
  <script src="sidebars/bootstrap.bundle.min.js"></script>
  <script>

    function verificaTamanho(inputElement, tamanho, proximoCampo) {
      if (inputElement.value.length > tamanho) {
        inputElement.value = inputElement.value.slice(0, tamanho);
      }
      if (inputElement.value.length === tamanho) {
        document.getElementById(proximoCampo).focus();
      }
    }

    function enviarFormulario() {
      var assunto = document.getElementById("assunto").value;
      var descricao = document.getElementById("descricao").value;
      var imagemInput = document.getElementById("imagem");
      var stiID = document.getElementById("stiID").value;

      if (assunto === '' || descricao === '' || stiID === '') {
        document.getElementById("erromsg").style.display = 'flex';
      }

      var formData = new FormData();
      formData.append("assunto", assunto);
      formData.append("descricao", descricao);
      formData.append("stiID", stiID);
      formData.append("imagem", imagemInput.files[0]);

      var xhr = new XMLHttpRequest();
      xhr.open("POST", "AbrindoChamado.php", true);

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          console.log(xhr.responseText);
        }
      };

      xhr.send(formData);
      exibirPopup();
    }




    function exibirPopup() {
      Swal.fire({
        icon: 'success',
        title: 'Confirmação',
        text: 'O chamado foi aberto, aguarde até visualizarmos sua solicitação. Você será notificado por e-mail quando houver alteração no status.',
        showConfirmButton: true,
        confirmButtonText: 'Entendi',
        timer: 10000,
        timerProgressBar: true, // Mostrar barra de progresso do timer
      }).then((result) => {
        // Após o tempo do timer, redireciona para a página desejada
        window.location.href = 'VendoChamados.html';
        // Verificar se o botão foi clicado
        if (result.isConfirmed) {
          // Redirecionar para a página desejada
          window.location.href = 'VendoChamados.html';
        }
      });
    }

    function handleCadastro(icone, response) {
      var nomeEquipamento = document.getElementById("nomeEquipamento");

      if (response === 'Equipamento nao encontrado') {
        nomeEquipamento.placeholder = 'Código inválido';
        nomeEquipamento.value = '';
      } else if (response !== 'Equipamento nao encontrado') {
        nomeEquipamento.placeholder = '';
      }
    }

    function verificaEquipamento() {
      var stiID = document.getElementById("stiID").value;
      // var equipamento = document.getElementById("nomeEquipamento");

      connection('stiID=' + stiID, 1, 'AbrindoChamado.php');
    }

    function connection(data, output, file) {
      var nomeEquipamento = document.getElementById("nomeEquipamento");

      var xhr = new XMLHttpRequest();
      xhr.open("POST", file, true);
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          if (output == 1) {
            var response = xhr.responseText;
            // console.log(response);
            nomeEquipamento.value = response;
            // foo(response);
            handleCadastro(document.getElementById("cadastroIcone") || document.getElementById("cadastroReady"), response);
          }
        }
      }
      xhr.send(data);
    }
  </script>



</body>

</html>
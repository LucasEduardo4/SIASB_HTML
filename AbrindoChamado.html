<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abrindo Chamado</title>
  <script src="/siasb_html/flowSite/verificaSessao.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="sidebars/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- //para o popup -->



  <style>
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      /* height: 100vh; */
      padding: 50px;
      max-width: 100%;
      background: none;

    }

    .div-superior {
      width: 4000px;
      min-width: 800px;
      background-color: #ffffff;
      padding: 20px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);


    }

    .logo {
      /* position: absolute; */
      width: 40px;
      height: 40px;
      left: 78px;
      margin: 0 auto;
      background-color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      /* z-index: 2; */
      top: 35px;
    }

    .logo img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 6px;
    }

    .div-inferior {
      width: 4500px;
      min-width: 700px;
      background-color: #ffffff;
      padding: 20px;
      /* z-index: 1; */
      margin-bottom: 50px;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);

    }

    .div-azul {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      min-width: 600px;

      /* position: absolute; */
      background-color: #00a383;
      color: #ffffff;
      padding: 15px;
      border-radius: 5px;
      /* z-index: 2; */
      /* width: 1028px; */
      width: 100%;
      top: 280px;
      text-align: center;
      font-size: 15px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);


    }



    .form {
      margin: 20px;
    }


    /* REALIZANDO ALTERAÇÃO DA DIV DOS CAMPOS DE CIMA DO FORMULÁRO */
    .top-div {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    /* ================================================================ */

    .setor-div,
    .assunto-div {
      flex-basis: 48%;
    }

    .bottom-div {
      display: flex;
      justify-content: space-between;
    }

    .descricao-div {
      flex-basis: 60%;

    }

    .upload-div {
      width: 100%;
      padding: 10px;
      border-width: 2px;
      border-style: dotted;
      border-color: black;
      border-radius: 5px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;

    }

    textarea {
      width: 81%;
      padding: 100px;
      border-radius: 7px;

    }

    input,
    select {
      width: 100%;
      padding: 10px;
      border-radius: 7px;
      font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;

    }

    #descricao {
      padding: 10px 20px;
      height: 200px;
      width: 100%;
      min-width: 500px;
    }

    .hardware-div {
      max-width: 98%;
      min-width: 300px;
      /* display: flex; */
      text-align: center;
      margin: 35px 0px;
      display: none;

    }

    .hardware-div label {
      padding: 10px;
    }

    .custom-fade-in {
      animation-duration: 0.5s !important;
    }

    .custom-slide-in {
      animation-duration: 1.5s !important;
    }

    .my-custom-icon {
      font-size: 200px;
      /* Defina o tamanho desejado */
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -moz-appearance: textfield;
      /* Remove as setas no Firefox */
    }
  </style>

</head>

<body style="background: none;">

  <div class="container">
    <div style="border-radius: 5px;" class="div-superior">
      <div style="border-radius: 10px;" class="logo">
        <img src="..\SIASB_HTML\Icones Site\TELEFONE.png" alt="saaeb barretos" width="40" height="40">
      </div>
      <h2 style="color: #000000;">SISTEMA DE CHAMADO SAAEB BARRETOS</h2>
      <p>
        Aqui você pode abrir um chamado para solucionar algum problema que você está tendo no seu setor.
      </p>
      <!-- Conteúdo adicional da div superior -->
    </div>
  </div>

  <div class="container">
    <div style="border-radius: 5px; " class="div-inferior">
      <div style="border: 2px;" class="div-azul">DESCREVA ABAIXO SUA SOLICITAÇÃO</div>
      <h2> </h2>
      <!-- Conteúdo adicional da div inferior -->
      <form class="blue-theme-form" enctype="multipart/form-data">

        <div style="margin-top: 30px;" class="top-div">
          <div class="assunto-div">
            <label for="assunto">Assunto:</label>
            <input placeholder="Digite o assunto" type="text" id="assunto" name="assunto">
          </div>


          <div class="setor-div">
            <label for="categoria">Categoria:</label>
            <select id="categoria" name="categoria" onchange="verifySelect()">
              <option value="" selected hidden required>Escolha uma das opções</option>
              <option value="hardware">Hardware</option>
              <option value="software">Software</option>
              <!-- Adicione mais opções conforme necessário -->
            </select>
          </div>
        </div>

        <div class="hardware-div animate__animated animate__fadeInDown custom-fade-in">
          <label for="stiID">STI_ID:</label>
          <input style="width: 150px;" type="number" id="stiID" name="stiID" onblur="verificaEquipamento()">
          <label for="nomeEquipamento"> Equipamento:</label>
          <input type="text" id="equipamentoNome" class="animate__animated animate__slideInRight" disabled value="">
          <h2 style="margin-left: 10px; display: none;" class="animate__animated animate__slideInRight custom-slide-in"
            id="plusCircle" title="Cadastrar equipamento"><i id="cadastroIcone" onclick='handleCadastro(this, 0)'
              class="bi bi-plus-circle-fill"></i></h2>
          <input type="checkbox" name="ExisteEquipamento" id="ExisteEquipamento" disabled hidden>
          <!-- Se nao for encontrado, exibir um icone para fazer um mini cadastro -->
        </div>

        <div style="margin-top: 0px;" class="descricao-div">
          <label for="descricao">Descrição:</label>
          <textarea placeholder="Descreva aqui o seu problema..." id="descricao" name="descricao" rows="4"></textarea>
        </div>

        <div style="margin-top: 30px;" class="upload-div">
          <label for="imagem">Envie uma imagem do problema:</label>
          <input type="file" id="imagem" name="imagem">
        </div>
        <div id="erromsg" class="container p-3 mt-3 bg-danger" style="border-radius: 16px; width: 70%; display: none;">
          <p>Preencha corretamente as informações acima</p>
        </div>

      </form>
      <button style="padding-top: 10px; padding-bottom: 10px; margin-top: 20px; width: 100%; border-radius: 16px;"
        class="btn btn-success" onclick="enviarFormulario()">ENVIAR</button>

      <!-- PASSANDO OS DADOS PARA O JAVASCRIPT -->
      <script src="sidebars/bootstrap.bundle.min.js"></script>
      <script>
        // function breveCadastro(icone) {
        //   var equipamento = document.getElementById("equipamentoNome");

        //   if (icone.id == 'cadastroReady') {
        //     // equipamento.value = equipamento.value;
        //     equipamento.disabled = true;
        //     icone.classList.add("bi-plus-circle-fill");
        //     icone.classList.remove("bi-check-circle-fill");
        //     icone.id = 'cadastroIcone';
        //   } else {
        //     equipamento.value = ''
        //     equipamento.placeholder = 'Equipamento nao encontrado, digite uma breve descrição sobre o equipamento:'
        //     equipamento.disabled = false;
        //     icone.classList.remove("bi-plus-circle-fill");
        //     icone.classList.add("bi-check-circle-fill");
        //     icone.id = 'cadastroReady';
        //     //bi bi-check-circle-fill
        //   }
        // }
        function handleCadastro(icone, response) {
          var equipamento = document.getElementById("equipamentoNome");
          // var circle = document.getElementById("plusCircle");
          var existe = document.getElementById("ExisteEquipamento");

          if (response === 'Equipamento nao encontrado') {
            // equipamento.style.width = '950';
            equipamento.placeholder = 'Equipamento nao encontrado, digite uma breve descrição sobre o equipamento:';
            // circle.style.display = 'block';
            equipamento.value = '';
            equipamento.disabled = false;
            // icone.classList.remove("bi-plus-circle-fill");
            // icone.classList.add("bi-check-circle-fill");
            // icone.id = 'cadastroReady';
            existe.checked = true;
          } else if (response !== 'Equipamento nao encontrado') {
            equipamento.style.width = '100%';
            equipamento.placeholder = '';
            // circle.style.display = 'none';
            equipamento.disabled = true;
            // icone.classList.add("bi-plus-circle-fill");
            // icone.classList.remove("bi-check-circle-fill");
            // icone.id = 'cadastroIcone';
            existe.checked = false;
          }
        }


        // function foo(response) {
        //   var equipamento = document.getElementById("equipamentoNome");
        //   var circle = document.getElementById("plusCircle");
        //   var existe = document.getElementById("ExisteEquipamento");


        //   if (response == 'Equipamento nao encontrado') {
        //     equipamento.style.width = '950px';
        //     equipamento.placeholder = 'Equipamento nao encontrado, digite uma breve descrição sobre o equipamento:';
        //     circle.style.display = 'block';
        //     // breveCadastro(document.getElementById("cadastroIcone") || document.getElementById("cadastroReady"));
        //     handleCadastro(document.getElementById("cadastroIcone") || document.getElementById("cadastroReady"), response);
        //   } else if (response != 'Equipamento nao encontrado') {
        //     equipamento.disabled = true;
        //     equipamento.style.width = '100%';
        //     equipamento.placeholder = ''
        //     circle.style.display = 'none';
        //   }
        //   if (equipamento.placeholder == 'Equipamento nao encontrado' || equipamento.placeholder == 'Equipamento nao encontrado, digite uma breve descrição sobre o equipamento:') {
        //     existe.checked = true;
        //   } else
        //     existe.checked = false;
        // }

        function enviarFormulario() {
          var assunto = document.getElementById("assunto").value;
          var descricao = document.getElementById("descricao").value;
          var imagemInput = document.getElementById("imagem");
          var selectCategoria = document.getElementById("categoria");
          var categoria = selectCategoria.options[selectCategoria.selectedIndex].value;
          var equipamento = "NULL";
          var existeEquipamento = document.getElementById("ExisteEquipamento");
          var equipamentoNome = "NULL";
          
          if (categoria == "hardware") {
            equipamento = document.getElementById("stiID").value;
            var equipamentoNome = document.getElementById("equipamentoNome").value;
          }
          if (assunto == '' || descricao == '' || categoria == '') {
            document.getElementById("erromsg").style.display = 'flex';
          } else {

            if (assunto === '' || descricao === '' || categoria == '') {
              document.getElementById("erromsg").style.display = 'flex';
            } else {
              var formData = new FormData();
              formData.append("existeEquipamento", existeEquipamento.checked);
              formData.append("assunto", assunto);
              formData.append("descricao", descricao);
              formData.append("equipamento", equipamento);
              formData.append("equipamentoNome", equipamentoNome);
              formData.append("categoria", categoria);
              formData.append("imagem", imagemInput.files[0]);

              var xhr = new XMLHttpRequest();
              xhr.open("POST", "AbrindoChamado.php", true);

              xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                  console.log(xhr.responseText);
                }
              };

              xhr.send(formData);
              // console.log(formData.assunto, formData.existeEquipamento);
              exibirPopup();
            }
          }
        }

        function exibirPopup() {
          Swal.fire({
            icon: 'success',
            title: 'Confirmação',
            text: 'O chamado foi aberto, aguarde até visualizarmos sua solicitação. Você será notificado por e-mail quando houver alteração no status.',
            showConfirmButton: true,
            confirmButtonText: 'Entendi',
            timer: 10000,
            timerProgressBar: true, // Mostrar barra de progresso do timer
          }).then((result) => {
            // Após o tempo do timer, redireciona para a página desejada
            window.location.href = 'VendoChamados.html';
            // Verificar se o botão foi clicado
            if (result.isConfirmed) {
              // Redirecionar para a página desejada
              window.location.href = 'VendoChamados.html';
            }
          });
        }

        function verifySelect() {
          if (document.getElementById("categoria")[1].selected == true) {
            document.querySelector(".hardware-div").style.display = "flex";
          } else
            if (document.getElementById("categoria")[2].selected == true) {
              document.querySelector(".hardware-div").style.display = "none";
            }
        }

        function verificaEquipamento() {
          var selectCategoria = document.getElementById("categoria");
          var categoria = selectCategoria.options[selectCategoria.selectedIndex].value;

          if (categoria == "hardware") {
            var stiID = document.getElementById("stiID").value;
            var equipamento = document.getElementById("equipamentoNome");

            connection('stiID=' + stiID, 1, 'AbrindoChamado.php');
          }
        }

        function connection(data, output, file) {
          var equipamento = document.getElementById("equipamentoNome");

          var xhr = new XMLHttpRequest();
          xhr.open("POST", file, true);
          xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
              if (output == 1) {
                var response = xhr.responseText;
                // console.log(response);
                equipamento.value = response;
                // foo(response);
                handleCadastro(document.getElementById("cadastroIcone") || document.getElementById("cadastroReady"), response);
              }
            }
          }
          xhr.send(data);
        }
      </script>

    </div>
  </div>
  </div>

</body>

</html>
<!-- Voltar no DetalhandoChamado.php (falta fazer os joins pra substituir os ID's pelos nomes) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="sidebars/bootstrap.min.css">
    <script src="/siasb_html/flowSite/verificaSessao.js"></script>

    <title>Detalhando Chamado</title>
</head>
<body>
    <div class="container">
        <div class="row">
          <div class="col-md-8">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">Detalhes do Chamado</h4>
                <h5 class="card-text" id="numChamado">Chamado nº </h5>
                <hr>
                <h5 class="card-text" id="assunto">Assunto: </h5>
                <hr>
                <p class="card-text" id="descricao">Descrição: </p>
                <hr>
                <p class="card-text">Logs: </p>
                <div class="resultados_log" id="resultados_log">
                  <p></p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Informações Adicionais</h5>
                <p class="card-text" id="autor">Autor: </p>
                <p class="card-text" id="responsavel">Analista Responsável: </p>
                <p class="card-text" id="dataAbertura">Data de Abertura: </p>
                <p class="card-text" id="status">Status: </p>
                <p class="card-text" id="equipamento">Equipamento: </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    <script src="sidebars/bootstrap.bundle.min.js"></script>
  <script>
    var url = new URL(window.location.href);
    var IDChamado = url.searchParams.get("IDChamado"); //22

    connection('ChamadoID=' + encodeURIComponent(IDChamado));

  function connection(data){      
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "DetalhandoChamado.php", true);
    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        // console.log(xhr.responseText);
        unParse(xhr.responseText);
      }
    };
    xhr.send(data);
  }

    function unParse(data) {
      var dadosObjeto = JSON.parse(data)
      var IDChamado = dadosObjeto.IDChamado;
      var assunto = dadosObjeto.assunto;
      var descricao = dadosObjeto.descricao;
      var dataAbertura = dadosObjeto.dataAbertura;
      var status_chamado = dadosObjeto.status_chamado;
      var responsavel = dadosObjeto.responsavel;
      var autor = dadosObjeto.autor;
      var equipamento = dadosObjeto.equipamento;
      var imagem = dadosObjeto.imagem;
      var categoria = dadosObjeto.categoria;
      // var ligacaoChamadoID = dadosObjeto.ligacaoChamadoID;


      dataAbertura = formatarDataHora(dataAbertura);
      
      document.getElementById("assunto").innerHTML += assunto;
      document.getElementById("descricao").innerHTML += '<br>'+ descricao;
      document.getElementById("dataAbertura").innerHTML += dataAbertura;
      document.getElementById("status").innerHTML += status_chamado;
      document.getElementById("responsavel").innerHTML += responsavel;
      document.getElementById("autor").innerHTML += autor;
      document.getElementById("equipamento").innerHTML += equipamento;
      document.getElementById("numChamado").innerHTML += IDChamado;
      // document.getElementById("categoria").innerHTML += categoria; ainda nao exibimos
      // document.getElementById("imagem").innerHTML += imagem;
      // if(ligacaoChamadoID == null){
      //   document.getElementById("resultados_log").innerHTML = "Não há logs para este chamado.";
      // }
    }

    

    function formatarDataHora(dataOriginal) {
      const date = new Date(dataOriginal);
      const dia = ('0' + date.getDate()).slice(-2);
      const mes = ('0' + (date.getMonth() + 1)).slice(-2);
      const ano = date.getFullYear().toString().slice(-2);
      const horas = ('0' + date.getHours()).slice(-2);
      const minutos = ('0' + date.getMinutes()).slice(-2);

      return `${dia}/${mes}/${ano} às ${horas}:${minutos}`;
    }


    
  </script>
</body>
</html>
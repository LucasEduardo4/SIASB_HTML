<!-- Voltar no DetalhandoChamado.php (falta fazer os joins pra substituir os ID's pelos nomes) -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="sidebars/bootstrap.min.css">
  <script src="/siasb_html/flowSite/verificaSessao.js"></script>
  <script src="/siasb_html/flowSite/verificaAtivo.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    .card {
      box-shadow: 0px 2px 4px rgba(68, 68, 68, 0.267)
    }

    /* CSS para a modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
    }

    .modal-content {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      position: relative;
    }

    .modal-img {
      max-width: 90%;
      max-height: 90%;
      border: 2px solid white;
    }

    /* CSS para as setas */
    .modal-prev,
    .modal-next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 50px;
      height: 30px;
      border-radius: 15px;
      background-color: rgba(255, 255, 255, 0.7);
      border: 1px solid #ccc;
      text-align: center;
      cursor: pointer;
      z-index: 1001;
    }

    .modal-prev {
      left: 10px;
    }

    .modal-next {
      right: 10px;
    }

    /* CSS para o botão de fechar */
    .modal-close-button {
      position: relative;
      top: 10px;
      right: 10px;
      background-color: rgba(255, 255, 255, 0.7);
      border: 1px solid #ccc;
      padding: 5px 25px;
      border-radius: 6px;
      cursor: pointer;
      z-index: 1001;
    }

    /* ============================================ */

    body {
      margin: 0;
      display: flex;
      background-color: #f0f0f0;
      /* border: #2ecc71; */
    }

    /* 
  .overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  } */

    .floating-box {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
      position: relative;
      max-width: 86%;
      margin-left: 90px;


    }

    #responsavel_tecnologia {
      display: none;
      width: 100%;
    }

    .returnButton {
      position: absolute;
      top: 0;
      left: 0;
      margin: 10px;
      text-decoration: none;
      color: black;
    }

    #imagemChamado {
      max-width: 100%;
    }

    /* 
    .card-body {

 
      
    } */

    .container_card {
      background-color: brown;
      border: 3px;
      border-color: black;
      background-color: rgb(255, 255, 255);
      padding-top: 40px;
      margin-top: 10px;
      border-radius: 8px;
      margin-bottom: 20px;
      padding-bottom: 100px;
      padding-left: 30px;
      padding-right: 10px;
      position: relative;


    }

    .superior {

      background-color: #40a38425;
      padding-top: 40px;
      padding-bottom: 50px;
      position: absolute;
      width: 100%;
      border: outset;
      border-color: #1987545e;


    }

    .chamados {

      width: 98%;
      margin-top: 7%;

    }

    .anexo {
      width: 64%;
      padding-left: 0.6%;
    }




    .statusColors {
      width: 100px;
      padding: 4px;
      color: white;
      border-radius: 3px;
      text-align: center;
      text-shadow: 0px 0px 2px black;
    }

    .Aberto {
      background-color: #e74c3c;
    }

    .Andamento {
      background-color: #7241dcf6;
    }

    .Pendente {
      background-color: #e67e22;
    }

    .Fechado {
      background-color: #2ecc71;


    }

    #iconeAutor {
      clip-path: circle(farthest-side);
    }

    .d-flex {
      display: flex;
    }

    #imagemAnexada {
      cursor: pointer;
    }

    .setas {
      background-color: #00cc99;
      color: white;
      border-radius: 20px;
      height: 20px;
      width: 2.5%;
      padding: 10px;
      display: inline;
      position: absolute;
      box-sizing: content-box;
    }

    .setas:hover {
      cursor: pointer;
      background-color: #00a383;
      transition: 0.4s;
      border-radius: 30px;
    }

    #imagemLOG {
      border: solid 1px black;
      /* box-shadow: 1px 8px 30px 10px grey; */
      box-shadow: 1px 8px 8px 3px grey;
    }

    #esquerda {
      margin: auto;
      left: 20px;
      top: 50%;
      height: fit-content;
    }

    #direita {
      height: fit-content;
      right: 20px;
      top: 50%;
    }

    .imagensAnexo {
      cursor: pointer;
      width: 220px;
      margin-right: 10px;
      border-radius: 10px;
    }

    .imagensAnexo:hover {
      transform: scale(1.1);
      transition: 0.4s;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
      border-radius: 6px;
    }

    #anexosContainer {
      display: flex;
      flex-direction: row;
    }

    .indicador {
      width: 10px;
      height: 10px;
      background-color: lightgray;
      border-radius: 50%;
      margin: 0 5px;
      display: inline-block;
      margin-bottom: 10px;
    }

    .indicador.ativo {
      background-color: darkgray;
    }

    .imagensAnexo {
      cursor: pointer;
      width: 220px;
      margin-right: 10px;
    }

    .imagensAnexo:hover {
      transform: scale(1.1);
      transition: 0.4s;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
      border-radius: 6px;
    }

    #anexosContainer {
      display: flex;
      flex-direction: row;
    }

    .Baixa {
      color: green;
    }

    .Média {
      color: #f5ac00;
    }

    .Alta {
      color: red;
    }

    .width-1920 {
      position: absolute;
      top: 130px;
      right: 3%;
      width: 310px;

    }

    .width-1536 {
      right: 2.5%;
      position: absolute;
      top: 130px;
      width: 250px;
    }
  </style>

  <title>Detalhando Chamado</title>
</head>

<body style="background-color: aliceblue;">
  <!-- <a href="/SIASB_HTML/VendoChamados.html" style="z-index: 10" class="returnButton"> -->
  <a href="javascript:history.back();" style="z-index: 10" class="returnButton">
    <h1><i class="bi-arrow-left-circle bi-lg"></i></h1>
  </a>


  <div class="superior">
    <div class="floating-box">
      <div style="display: inline-block; width: 45%;">
        <h4 id="numChamado" id="dataAbertura" style="z-index: 10; font-size: 20px; ">CHAMADO: </h4>
      </div>
      <div style="display: inline-block; width: 45%; text-align: center;">
        <h4 style="display: inline;">Prioridade:</h4>
        <h4 style="display: inline;" id="prioridade"></h4>
      </div>
    </div>
  </div>
  <div class="container my-3 p-0" id="containerBtn" style="z-index: 2;">
    <button type="button" id="responsavel_tecnologia" class="btn btn-success" onclick="alterarChamado()">
      Dar andamento ao chamado <i class="bi bi-chevron-double-right"></i>
    </button>
  </div>



  <!-- <div id="anexosContainer"></div>
    
  <script>
  var xhr = new XMLHttpRequest();
  xhr.open("GET", "DetalhandoChamado.php", true);
  xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
          var icone = xhr.responseText;
          if (icone) {
              document.getElementById("anexosContainer").innerHTML +=
                  '<p> <img id="icone" src="data:image/jpeg;base64,' + icone + '" width="50" height="50" alt="Imagem do chamado" /></p>';
          } else {
              document.getElementById("anexosContainer").innerHTML +=
                  '<p>Nenhuma imagem anexada para este chamado.</p>';
          }
      }
  };
  xhr.send();
  </script> -->

  <div class="chamados">
    <div style="padding-top: 90px;" class="row">
      <div class="col-md-8">
        <div class="card" style="margin-left: 20px; margin-top: 1%;">
          <div class="card-body container_card">
            <h5 class="card-text" id="assunto">ASSUNTO DO CHAMADO<br><br> </h5>
            <hr>
            <p style="color: rgb(75, 75, 75); font-weight: bold;">DESCRIÇÃO: </p>
            <p class="card-text" id="descricao"></p>
            <hr>
            <p class="card-text" style="font-weight: bold;">ANDAMENTO DO CHAMADO:</p>
            <div class="resultados_log" id="resultados_log"
              style="background-color: #40a38436; border-radius: 5px; padding: 6px;">
              <div class="container mt-4" id="logsContainer">
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="col-md-4">
        <div class="card" style="margin-top: 4.3%;">
          <div class="card-body">
            <h5>Informações Adicionais
              <hr>
            </h5>
            <p class="card-text" id="AutorLabel" style="font-weight: bold;">AUTOR: </p>
            <p id="autor"> </p>

            <p class="card-text" style="font-weight: bold;">ANALISTA RESPONSÁVEL: </p>
            <p id="responsavel"> </p>

            <p class="card-text" style="font-weight: bold;">DATA DE ABERTURA: </p>
            <p id="dataAbertura"> </p>

            <p class="card-text" style="font-weight: bold;">STATUS:</p>
            <p id="status"> </p>
            <!-- </span> -->
            <p class="card-text" style="font-weight: bold;">EQUIPAMENTO: </p>
            <p id="equipamento"></p>
          </div>
        </div>

      </div>
    </div>
    <div class="row" style="margin-left:20px; margin-right: 1px;">
      <div class="card" style="margin-top: 15px;">
        <!-- DIV QUE EU IREI MECHER PARA REALZIZAR A ALTERAÇÃO DA PROPORÇÃO -->
        <div class="card-body">
          <h5>ANEXOS:</h5>
          <div style="display: flex; flex-wrap: wrap; padding-top: 10px;" class="mt-4" id="anexosContainer">
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="sidebars/bootstrap.bundle.min.js"></script>
  <script>
    function foo() {
      var containerBtn = document.getElementById("containerBtn");
      if (window.screen.width <= 1540) {
        containerBtn.classList.add("width-1536");
      } else {
        containerBtn.classList.add("width-1920");

      }
    }
    foo();



    var PRIORIDADE = Array();
    var STATUS = Array();
    var url = new URL(window.location.href);
    var IDChamado = url.searchParams.get("IDChamado");
    let currentIndex = 0;
    let imagensExemplo = ['base64-imagem-1', 'base64-imagem-2', 'base64-imagem-3'];

    connection('ChamadoID=' + encodeURIComponent(IDChamado), 1);

    function connection(data, operation) {
      var xhr = new XMLHttpRequest();
      xhr.open("POST", "DetalhandoChamado.php", true);

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          if (xhr.responseText == 'Não autorizado') {
            window.location.href = "/siasb_html/flowSite/permissaonegada.html";
            exit();
          }
          if (operation == 1) {
            unParse(xhr.responseText);
          } else if (operation == 2) {
            // console.log(xhr.responseText);

          } else if (operation == 'verificarSetor') {
            if (xhr.responseText == '1') {
              controlarResponsavel_Tecnologia();
            }
          }
        }
      };

      if (data instanceof FormData) {
        // xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary=" + data._boundary);
        xhr.send(data);
      } else {
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send(data);
      }
    }

    function unParse(data) {
      var dadosObjeto = JSON.parse(data)
      var IDChamado = dadosObjeto.IDChamado;
      var assunto = dadosObjeto.assunto;
      var descricao = dadosObjeto.descricao;
      var dataAbertura = dadosObjeto.dataAbertura;
      var status_chamado = dadosObjeto.status_chamado;
      var prioridadeChamado = dadosObjeto.prioridadeChamado;
      var responsavel = dadosObjeto.responsavel;
      var autor = dadosObjeto.autor;
      var equipamento = dadosObjeto.equipamento;
      var imagensChamado = dadosObjeto.imagensChamado;
      var logs = dadosObjeto.logs;
      var icone = dadosObjeto.icone;
      var prioridadePopup = dadosObjeto.prioridadePopup;
      var status = dadosObjeto.status;
      PRIORIDADEPOPUP = prioridadePopup;
      STATUS = status;

      if (logs[0]) {
        exibeLogs(logs);
      } else {
        var logAndamento = document.getElementById("resultados_log");
        logAndamento.innerHTML = "Aguarde, ainda não houve alteração no seu chamado.";
      }


      if (imagensChamado && imagensChamado.length == 0) {
        document.getElementById("anexosContainer").innerHTML += '<p>Nenhuma imagem anexada para este chamado.</p>';
      } else {
        exibeImagens(imagensChamado)
      }

      dataAbertura = formatarDataHora(dataAbertura);
      document.getElementById("assunto").innerHTML += assunto;
      document.getElementById("descricao").innerHTML += '<br>' + descricao;
      document.getElementById("dataAbertura").innerHTML += dataAbertura;
      document.getElementById("status").innerHTML += status_chamado;
      document.getElementById("prioridade").innerHTML += ' ' + (prioridadeChamado == 'undefined' ? 'Ainda não definida' : prioridadeChamado);
      document.getElementById("prioridade").classList.add(prioridadeChamado);
      document.getElementById("responsavel").innerHTML += (responsavel == null ? "-----" : responsavel);
      document.getElementById("autor").innerHTML += autor;
      if (equipamento != null) {
        document.getElementById("equipamento").innerHTML += `${equipamento}`;
      } else {
        document.getElementById("equipamento").style.display = 'none';
      }
      document.getElementById("numChamado").innerHTML += IDChamado;

      if (icone) {
        document.getElementById("AutorLabel").innerHTML +=
          '<img id="iconeAutor" src="data:image/jpeg;base64,' + icone + '" width="100px" alt="Ícone do autor" /></p>';
      } else {
        document.getElementById("AutorLabel").innerHTML +=
          '';

      }

    }

    // Função para exibir imagens com modal
    function exibeImagens(imagens) {
      const containerAnexos = document.getElementById("anexosContainer");
      if (imagens) {
        imagens.forEach((imagemBase64, index) => {
          const imagemElement = document.createElement('img');
          imagemElement.className = 'imagensAnexo';
          imagemElement.src = `data:image/jpeg;base64, ${imagemBase64}`;
          imagemElement.alt = 'Imagem do chamado';

          // Adicionar evento de clique para abrir em um popup
          imagemElement.addEventListener('click', () => {
            currentIndex = index;
            abrirImagemPopup(imagemBase64, imagens);
          });

          const divRow = document.createElement('div');
          divRow.className = 'row';
          const divCol = document.createElement('div');
          divCol.className = 'col-md-4';

          divCol.appendChild(imagemElement);
          divRow.appendChild(divCol);
          containerAnexos.appendChild(divRow);
        });
      }
    }

    // Função para abrir imagem em um popup com setas de navegação
    function abrirImagemPopup(imagemBase64, imagens) {
      // Crie a modal
      const modal = document.createElement('div');
      modal.className = 'modal';

      // Crie o conteúdo da modal
      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content';

      // Crie uma seta para a esquerda
      const prevArrow = document.createElement('div');
      prevArrow.className = 'modal-prev';
      prevArrow.innerHTML = '<';
      modalContent.appendChild(prevArrow);

      // Crie uma seta para a direita
      const nextArrow = document.createElement('div');
      nextArrow.className = 'modal-next';
      nextArrow.innerHTML = '>';
      modalContent.appendChild(nextArrow);

      // Crie a imagem dentro da modal
      const imagemElement = document.createElement('img');
      imagemElement.className = 'modal-img';
      imagemElement.src = `data:image/jpeg;base64, ${imagemBase64}`;
      imagemElement.alt = 'Imagem do chamado';

      // Adicione a imagem ao conteúdo da modal
      modalContent.appendChild(imagemElement);

      // Crie o botão de fechar
      const closeButton = document.createElement('div');
      closeButton.className = 'modal-close-button';
      closeButton.innerHTML = 'Fechar';
      closeButton.addEventListener('click', () => {
        modal.style.display = 'none';
        modal.remove();
      });
      modalContent.appendChild(closeButton);

      // Adicione o conteúdo da modal à modal
      modal.appendChild(modalContent);

      // Exiba a modal
      modal.style.display = 'block';

      // Evento de clique para a seta da esquerda
      prevArrow.addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex--;
          imagemElement.src = `data:image/jpeg;base64, ${imagens[currentIndex]}`;
        }
      });

      // Evento de clique para a seta da direita
      nextArrow.addEventListener('click', () => {
        if (currentIndex < imagens.length - 1) {
          currentIndex++;
          imagemElement.src = `data:image/jpeg;base64, ${imagens[currentIndex]}`;
        }
      });

      // Adicione a modal ao corpo do documento
      document.body.appendChild(modal);
    }


    function exibeLogs(logs) {
      const logsContainer = document.getElementById("logsContainer");

      logs.forEach((log) => {
        const div = document.createElement("div");
        div.classList.add("row", "mb-3");

        const col = document.createElement("div");
        col.classList.add("col", "px-0");

        const dFlex = document.createElement("div");
        // dFlex.classList.add("d-flex");

        const div1 = document.createElement("div");
        div1.classList.add("d-flex");

        const responsavelStatus = document.createElement("p");
        responsavelStatus.classList.add("mb-0");
        responsavelStatus.style.marginRight = "10px";
        responsavelStatus.textContent = log.responsavel + " alterou status para: " + log.status;
        responsavelStatus.src = "Icones%20Site/anexo.png";

        div1.appendChild(responsavelStatus);
        if (log.imagensLog && log.imagensLog.length > 0) {
          const imagem = document.createElement("img");
          imagem.classList.add("ml-3");
          imagem.src = "Icones%20Site/anexo.png";
          imagem.width = 30;
          imagem.title = "Clique para visualizar a imagem anexada à resposta";
          imagem.id = "imagemAnexada";
          imagem.onclick = function () {
            exibeImagensAnexadas(log.imagensLog);
          }

          div1.appendChild(imagem);
        }

        const div2 = document.createElement("div");
        div2.classList.add("border-start", "border-primary", "px-3");

        const mensagem = document.createElement("p");
        mensagem.classList.add("mb-0");
        mensagem.textContent = "motivo:  " + log.mensagem;
        div2.appendChild(mensagem);

        const dataParagrafo = document.createElement("p");
        dataParagrafo.classList.add("mb-0");
        dataParagrafo.textContent = formatarDataHora(log.dataAlteracao);
        div2.appendChild(dataParagrafo);

        div.appendChild(col);
        col.appendChild(dFlex);
        dFlex.appendChild(div1);
        div.appendChild(div2);

        logsContainer.appendChild(div);
      });

      function exibepropriedade(propriedade) {

      }
    }

    function exibeImagensAnexadas(imagens) {
      
      if (window.screen.width < 1025) {
        var responsiveSize = window.screen.width * 0.65;
      } else {
        var responsiveSize = window.screen.width * 0.8;
      }

      let currentIndex = 0; // Índice da imagem atual

      function showImage(index) {
        const html = `<div id="indicadores"></div>
              <div id="esquerda" class="setas"><span class="bi bi-arrow-left"></span></div>
              <div id="central" style="width:70%; display:inline;">
                <img id="imagemLOG" src="data:image/jpeg;base64, ${imagens[index].dados}" width="90%" alt="Imagem do log">
              </div>
              <div id="direita" class="setas"><span class="bi bi-arrow-right"></span></div>
            `;
        Swal.fire({
          //1.7778
          title: "Imagem anexada",
          html: html,
          width: window.screen.width - 400,
          showCancelButton: false,
          confirmButtonText: 'Fechar',
          confirmButtonColor: '#00cc99'
        });
        const indicadoresDiv = document.getElementById("indicadores");
        indicadoresDiv.innerHTML = "";
        if (imagens.length == 1) {
          document.getElementById("esquerda").style.display = "none";
          document.getElementById("direita").style.display = "none";
        }
        for (let i = 0; i < imagens.length; i++) {
          const indicador = document.createElement("div");
          indicador.classList.add("indicador");

          // Defina uma classe especial para o indicador da imagem atual
          if (i === index) {
            indicador.classList.add("ativo");
          }

          // Adicione o indicador à seção de indicadores
          indicadoresDiv.appendChild(indicador);
        }

        // Adicione manipuladores de eventos às setas esquerda e direita
        const esquerda = document.getElementById("esquerda");
        const direita = document.getElementById("direita");

        esquerda.addEventListener("click", () => {
          if (currentIndex > 0) {
            currentIndex--;
            updateImage(currentIndex);
          }
        });

        direita.addEventListener("click", () => {
          if (currentIndex < imagens.length - 1) {
            currentIndex++;
            updateImage(currentIndex);
          }
        });

      }

      function updateImage(index) {
        const indicadores = document.querySelectorAll(".indicador");

        indicadores.forEach((indicador) => {
          indicador.classList.remove("ativo");
        });

        indicadores[index].classList.add("ativo");

        document.getElementById("central").innerHTML = `<img id="imagemLOG" src="data:image/jpeg;base64, ${imagens[index].dados}" width="90%;" alt="Imagem do log">`;
      }

      showImage(currentIndex);


    }

    function formatarDataHora(dataOriginal) {
      const date = new Date(dataOriginal);
      const dia = ('0' + date.getDate()).slice(-2);
      const mes = ('0' + (date.getMonth() + 1)).slice(-2);
      const ano = date.getFullYear().toString().slice(-2);
      const horas = ('0' + date.getHours()).slice(-2);
      const minutos = ('0' + date.getMinutes()).slice(-2);

      return `${dia}/${mes}/${ano} às ${horas}:${minutos}`;
    }

    verificaSetor(); // precisa rodar essa função.. para que o administrador consiga dar andamento ao chamado.

    function verificaSetor() {
      var data = "verificarSetor=" + encodeURIComponent('1');
      connection(data, 'verificarSetor');
    }

    function controlarResponsavel_Tecnologia() {
      var responsavel_tecnologia = document.getElementById("responsavel_tecnologia");
      responsavel_tecnologia.style.display = "inline";
    }

    function alterarChamado() {
      // Criando um formulário HTML
      const formHTML = `
          <form id="alterarChamadoForm" class="text-start" enctype="multipart/form-data">
            <div class="my-3">
              <div class="d-flex">
                <label for="status" class="form-label" style="margin:auto; padding-right:15px; width:140px">Status:</label>
                <select id="statusPopup" class="form-select form-select-sm">
                  <option value="" selected hidden>Selecione um status</option>
                  ${STATUS.map((status) => status.descricao != 'TODOS' && status.descricao != 'Aberto' ? `<option value='${status.ID}'>${status.descricao}</option>` : ``).join("")}
                </select>
              </div>
            </div>
            <div class="mb-3">
              <div class="d-flex">
                <label style="margin:auto; padding-right:15px; width:140px">Prioridade:</label>
                <select id="prioridadePopup" class="form-select form-select-sm">
                  <option value="" selected hidden>Selecione um nível de prioridade</option>
                 ${PRIORIDADEPOPUP.map((prioridade) => `<option value='${prioridade.ID}'>${prioridade.descricao}</option>`).join("")}
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label for="mensagem" class="form-label">Mensagem:</label>
              <textarea id="mensagem" class="form-control" rows="4"></textarea>
            </div>
            <div class="mb-3">
              <label>Anexar Imagem:</label>
              <input type="file" name="imagem" id="imagem" class="form-control" multiple>
            </div>
          </form>
        `;

      // Exibindo o popup com o formulário
      Swal.fire({
        title: "Atualizar o Status do Chamado",
        html: formHTML,
        showCancelButton: true,
        confirmButtonColor: '#00cc99',
        confirmButtonText: 'Atualizar Status',
        cancelButtonText: 'Cancelar',
      }).then((result) => {
        if (result) {
          if (result.isConfirmed) {
            // Aqui você pode implementar o código para enviar o formulário
            var status = document.getElementById("statusPopup").value;
            var prioridade = document.getElementById("prioridadePopup").value;
            var mensagem = document.getElementById("mensagem").value;
            var imagemInput = document.getElementById("imagem");

            // S(`status -> ${status} \nprioridade -> ${prioridade} \nmensagem -> ${mensagem} \nimagem -> ${imagemInput.files[0]}`)

            if (!status && !prioridade && !mensagem) {
              Swal.fire({
                title: 'Operação cancelada',
                text: 'Nenhum campo foi preenchido.',
                icon: 'error',
                timer: 3000
              }).then(() => {
                window.location.reload();
              });
              return; // Impede que o código continue se os campos estiverem incompletos
            } else
              if (!status && prioridade && !mensagem) {
                Swal.fire({
                  title: 'Prioridade alterada!',
                  // text: 'A Prioridade foi alterada.',
                  icon: 'success',
                  timer: 3000
                }).then(() => {
                  window.location.reload();
                });
              } else
                if (status && !prioridade && !mensagem) {
                  Swal.fire({
                    title: 'Digite um motivo para alterar o status!',
                    // text: 'O Status foi alterado.',
                    icon: 'warning',
                    timer: 3000
                  }).then(() => {
                    window.location.reload();
                  });
                  return;
                } else
                  if (status && prioridade && mensagem) {
                    Swal.fire({
                      title: 'Alterado!',
                      text: 'Chamado alterado com sucesso',
                      icon: 'success',
                      timer: 3000
                    }).then(() => {
                      window.location.reload();
                    });
                  } else {
                    Swal.fire({
                      title: 'Erro!',
                      text: 'Preencha os campos corretamente',
                      icon: 'error',
                      timer: 3000
                    }).then(() => {
                      window.location.reload();
                    });
                    return;
                  }

            var data = new FormData();
            data.append("gerarLog", "1");
            data.append("status", status);
            data.append("prioridade", prioridade);
            data.append("mensagem", mensagem);
            data.append("referencia", IDChamado);

            var result = "gerarLog: 1"  + "<br>" +
              "status: " + status + "<br>" +
              "prioridade: " + prioridade + "<br>" +
              "mensagem: " + mensagem + "<br>" +
              "<br> qtdImagens: " + imagemInput.files.length + "<br>";

            // console.log(result);

            if (imagemInput.files.length > 0) {
              for (var i = 0; i < imagemInput.files.length; i++) {
                data.append("imagem[]", imagemInput.files[i]);
              }
            }
            connection(data, 2);
            // window.location.reload();
          }
        }
      });
    }

  </script>
</body>

</html>
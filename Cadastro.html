<!DOCTYPE html>
<html>
<head>
  <title>Cadastro</title>
  <link rel="stylesheet" href="Inicial.css">
  <link rel="icon" href="https://saaeb.com.br/wp-content/uploads/2019/09/favicon.png" sizes="192x192"/>

  <meta charset="UTF-8">


</head>
<body onload="init()">
  <div class="container">
    <h1>Cadastro</h1>
    <!-- <h2>OBS. tirei o method do form.. preciso adicionar um XMLHttpRequest no script</h2> -->
    <form>
      <div class="form-group">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" placeholder="Informe seu nome">
      </div>
      <div class="form-group">
        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" name="cpf" placeholder="Informe seu CPF">
      </div>
      <div class="form-group">
        <label for="matricula">Número de Matrícula:</label>
        <input type="text" id="matricula" name="matricula" placeholder="Informe seu número de matrícula">
      </div>
      <div class="form-group">
        <label for="setor">Setor:</label>
        <select id="setor" name="setor">
          <option value="" disabled selected hidden>Escolha uma das opções</option>

          <!-- <option value="TI">TI</option>
          <option value="ADM">ADM</option>
          <option value="RH">RH</option>
          <option value="CONTABILIDADE">CONTABILIDADE</option> -->
        </select>
      </div>
      <div class="form-group">
        <label for="email">E-mail:</label>
        <input type="text" id="email" name="email" placeholder="Informe seu e-mail">
      </div>
    </form>
    <div class="form-group">
      <button onclick="submitForm()">Cadastrar</button>
    </div>
  </div>
</body>



<script>
  function init(){
    getSelect();
  }
  function getSelect(){
    var setor = document.getElementById("setor");
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "Cadastro.php", true)
    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhr.onreadystatechange = function(){
      if(xhr.readyState === 4){
        if(xhr.status === 200){
          setor.innerHTML += xhr.responseText;
        }else{
          console.error("Erro ao carregar os setores")
        }
      }
    };
    xhr.send("select_setor=" + encodeURIComponent(1));
  }

  function submitForm(){
    let nome = document.getElementById("nome").value;
    let cpf = document.getElementById("cpf").value;
    let matricula = document.getElementById("matricula").value;
    let setor = document.getElementById("setor").value;
    let email = document.getElementById("email").value;

    var i=0;
    // var options = document.getElementsByTagName("option");
    // while(i < options.length){
    // if(options[i].selected == true){
    //   setor = options[i].value;
    //   i++;
    // }
    // else
    //   i++;
    // }

    var xhr = new XMLHttpRequest();
            xhr.open("POST", "Cadastro.php", true)
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function(){
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        window.location.reload();
                    } else {
                        console.error("Falha ao carregar as pessoas");
                    }
                }
            };
            xhr.send("nome=" + encodeURIComponent(nome) + "&cpf=" + encodeURIComponent(cpf) + "&matricula=" + encodeURIComponent(matricula)+ "&setor=" + encodeURIComponent(setor) + "&email=" + encodeURIComponent(email));
  }
</script>
</html>
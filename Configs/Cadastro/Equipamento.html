<!DOCTYPE html>
<html>
<head>
  <title>Cadastro</title>
  <link rel="stylesheet" href="../../Inicial.css">
  <link rel="icon" href="https://saaeb.com.br/wp-content/uploads/2019/09/favicon.png" sizes="192x192"/>
  <script src="/siasb_html/flowSite/verificaSessao.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- //para o popup Sweet alert-->
  <script src='./../../flowSite/verificaSessao.js'></script>



  <meta charset="UTF-8">


</head>
<body onload="init()">
  <div class="container">
    <h1>Cadastro Equipamento</h1>
    
    <form>
      <div class="form-group">
        <label for="stiID">Sti_ID:</label>
        <input type="text" id="stiID" name="stiID" placeholder="Informe o Sti_ID do equipamento">
      </div>
      <div class="form-group">
        <label for="descricao">Descrição do Equipamento:</label>
        <input type="text" id="descricao" name="descricao" placeholder="Ex: Impressora brother, modelo X">
      </div>
      <div class="form-group">
        <label for="ip">IP:</label>
        <input type="text" id="ip" name="ip" placeholder="IP do equipamento">
      </div>
      <div class="form-group">
        <label for="tipo">Tipo:</label>
        <select id="selectTipos" name="tipo">
          <option value="" disabled selected hidden>Escolha uma das opções</option>
          <option value="">Aqui preciso de um select no banco de dados, para todos os tipos de equipamentos possiveis</option>
        </select>
      </div>
      <div class="form-group">
        <label for="secao">Seção:</label>
        <select id="selectSecoes" name="secao" onchange="selectPerson()">
          <option value="" disabled selected hidden>Escolha uma das opções</option>
        </select>
      </div>
      <div class="form-group">
        <label for="usuario">Usuário:</label>
        <select id="selectPessoas" name="usuario">
          <option value="" disabled selected hidden>Escolha primeiro a seção</option>
        </select>
      </div>
    </form>
    <div class="form-group">
      <button onclick="submitForm()">Cadastrar</button>
    </div>
</div>
<script>
  var selectPessoas = document.getElementById("selectPessoas");

  function init(){
    SelectsTipo_Secao();
  }

  function SelectsTipo_Secao(){
    var data = 'Select_Tipo_Secao=' + 1;
    connection("POST", data, "selects")
  }
  
  function selectPerson(){
    var selectSecoes = document.getElementById("selectSecoes");
    var secao = selectSecoes.options[selectSecoes.selectedIndex].value;
    var data = 'Select_Person_on_secao=' + secao;
    connection("POST", data, selectPessoas)
    // console.log("Entrou aqui");

  }
  
  function submitForm(){
  var stiID = document.getElementById("stiID").value;
  var descricao = document.getElementById("descricao").value;
  var ip = document.getElementById("ip").value;
  var tipo = document.getElementById("selectTipos").value;
  var secao = document.getElementById("selectSecoes").value;
  var usuario = document.getElementById("selectPessoas").value;
  var data = 'submitForm=1'+ '&stiID=' + encodeURIComponent(stiID) + '&descricao=' + encodeURIComponent(descricao) + '&ip=' + encodeURIComponent(ip) + '&tipo=' + encodeURIComponent(tipo) + '&secao=' + encodeURIComponent(secao) + '&usuario=' + encodeURIComponent(usuario);
  connection("POST", data, "cadastro")
}

  function connection(method, data, output){
    var xhr = new XMLHttpRequest();
    xhr.open(method, "Equipamento.php", true);
    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        if(output == "selects"){
          unParse(xhr.responseText);
          // console.log(xhr.responseText);
        }else
        if(output == selectPessoas){
          // console.log("Entrou aqui");
          output.innerHTML += xhr.responseText;
        }else
        if(output == "cadastro"){
          Swal.fire({
                icon: 'success',
                title: 'Equipamento inserido com sucesso',
                showConfirmButton: false,
                timer: 3000
              }).then(() => {
                window.location.reload();
              });
        }
      } 
    }
    xhr.send(data);
  }
  
  function unParse(data){
      var dadosObjeto = JSON.parse(data)
      var tipos = dadosObjeto.tipos;
      var secoes = dadosObjeto.secoes;
      let selectTipos = document.getElementById("selectTipos");
      let selectSecoes = document.getElementById("selectSecoes");
      var i=0;

      selectTipos.innerHTML = '<option value="" disabled selected hidden>-------------------------</option>'
      selectSecoes.innerHTML = '<option value="" disabled selected hidden>-------------------------</option>'

      console.log(tipos);
      console.log(secoes);
      //colocar a condição dos innerhtml

      for (let key in tipos) {
      let value = tipos[key];
      selectTipos.innerHTML += `<option value="${key}">${value}</option>`;
      }
      for (let key in secoes) {
      let value = secoes[key];
      selectSecoes.innerHTML += `<option value="${key}">${value}</option>`;
      }
    }

</script>
</body>
</html>
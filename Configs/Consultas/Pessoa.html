<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Pessoas</title>
    <link rel="stylesheet" href="../../sidebars/bootstrap.min.css">
    <link rel="icon" href="../../icons/warning.png" sizes="192x192"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../lib/stylesheet.css">
    <script src='./../../flowSite/verificaSessao.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- //para o popup -->

    <style>
        .swal-columns {
            display: flex;
            flex-direction: column;
        }
        .swal-columns input {
            margin: 20px 0px;
        }
    </style>


</head>
<header>
    <div>
        <a href="../index.html">

        <h1><i class="bi-arrow-left-circle bi-lg ">Voltar</i></h1></a>
        
    </div>
</header>
<body onload="init()">

    <h3>Pessoas:</h3>
    <p>Filtros:</p>
    
    <div class="box-sqr">
        <table id="tablePerson" class="table table-striped table-hover">
            <tr class="table table-dark ">
                <th>IDPessoa</th>
                <th>Nome</th>
                <th>CPF</th>
                <th>Matrícula</th>
                <th>Setor</th>
                <th>Secao</th>
                <th>E-mail</th>
                <th>Gestor</th>
                <th>Usuário</th>
            </tr>
        </table>
    </div>

<script>
    function init() {
        displayPersons();
    }

    function displayPersons(){
        var xhr = new XMLHttpRequest();
            xhr.open("POST", "php/consultas.php", true)
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function(){
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        tablePerson.innerHTML += xhr.responseText;
                    } else {
                        tablePerson.innerHTML += "Falha ao carregar as pessoas";
                    }
                }
            };
            xhr.send("select_ready_person=" + encodeURIComponent(1));

    }
    function setupEditButtons() {
            var sqrchk = document.getElementsByClassName("bi bi-check-square");
            var sqr = document.getElementsByClassName("bi bi-square");

            for (var i = 0; i < editButtons.length; i++) {
                (function(id) {

                    var removeButton = removeButtons[i];
                    removeButton.addEventListener("click", function() {
                        var element = document.querySelector("#tableStatus tr:nth-child(" + (id + 1) + ")");
                        var ref = element.cells[0].innerText;
                        removeValue(ref);
                    });
                })(i);
            }
        }
        function onoffGerente(ID){
            console.log("entrou")
            var verifica = document.getElementById(`sqr-${ID}`)
            if(verifica.dataset.value == 0){
                verifica = 'desmarcado';
            }else if(verifica.dataset.value == 1){
                verifica = 'marcado';
            }

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "php/consultas.php", true)
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function(){
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        window.location.reload();
                    } else {
                        console.error("Falha ao carregar as pessoas");
                    }
                }
            };
            xhr.send("verifica=" + encodeURIComponent(verifica)+ "&id=" + ID);
        }
        function verificaUsuario(usuario){
            var usuarioID = usuario.id
            
            abrirPopup(usuarioID);
            function abrirPopup(usuarioID) {
                Swal.fire({
                    title: 'Escolha uma opção, para alterar o tipo de usuário',
                    html: `
                    <div class="swal-columns">
                        <label>
                        <input type="radio" name="opcao" id="opcao1" value="opcao1">
                        Usuário Comum
                        </label>
                        <label>
                        <input type="radio" name="opcao" id="opcao2" value="opcao2">
                        Administrador
                        </label>
                        <label id='naocadastrado'>
                        <input type="radio" name="opcao" id="opcao3" value="opcao3">
                        Não Cadastrado
                        </label>
                    </div>
                    `,
                    inputValidator: (result) => {
                    if (!result) {
                        return 'Você precisa selecionar uma opção!';
                    }
                    },
                    showCancelButton: true,
                    cancelButtonText: 'Cancelar',
                    confirmButtonText: 'Confirmar',
                    preConfirm: () => {
                    const selectedOption = document.querySelector('input[name="opcao"]:checked').value;
                    if (selectedOption === 'opcao1') { //usuario comum
                        if(usuarioID == 'usuarioNaoCadastrado')
                            CadastroUsuario(0);
                        else if(usuarioID == 'usuarioAdministrador'){
                            console.log('retirar privilegio')
                        }
                        if(usuarioID == 'usuarioComum')
                            usuarioExistente();
                    } else if (selectedOption === 'opcao2') {// Ação para Administrador
                        if(usuarioID == 'usuarioNaoCadastrado'){
                            CadastroUsuario(1);
                        }else 
                        if(usuarioID == 'usuarioComum'){
                            console.log('adicionar privilegio');
                        }else
                        if(usuarioID == 'usuarioAdministrador')
                            usuarioExistente();
                    } else if (selectedOption === 'opcao3') {// nao cadastrado
                        console.log('opcao 3');
                    }
                    }
                });
                var opcao1 = document.getElementById('opcao1');
                var opcao2 = document.getElementById('opcao2');
                var opcao3 = document.getElementById('opcao3');
                var label = document.getElementById('naocadastrado')

                if (usuarioID == 'usuarioComum') {
                    opcao1.checked = true;
                    opcao1.disabled = true;
                    label.innerHTML= '<input type="radio" name="opcao" id="opcao3" value="opcao3"> Desabilitar Usuário';
                } else if (usuarioID == 'usuarioAdministrador') {
                    opcao2.checked = true;
                    opcao2.disabled = true;
                    label.innerHTML= '<input type="radio" name="opcao" id="opcao3" value="opcao3"> Desabilitar Usuário';
                } else if (usuarioID == 'usuarioNaoCadastrado') {
                    opcao3.checked = true;
                    opcao3.disabled = true;
                    
                }
                }

                function CadastroUsuario(adm){
                    Swal.fire({
                        title: 'Digite o nome de usuário e senha para o usuario novo:',
                        html:
                        '<input id="nome" class="swal2-input" placeholder="Nome">' +
                        '<input id="senha" type="password" class="swal2-input" placeholder="Senha">' +
                        '<label for="administrador" class="swal2-checkbox">' +
                        '<input id="administrador" type="checkbox" class="swal2-input" style="height: auto;">' +
                        '<span class="swal2-label">Administrador</span>' +
                        '</label>',
                        showCancelButton: true,
                        confirmButtonText: 'Confirmar',
                        cancelButtonText: 'Cancelar',
                        preConfirm: () => {
                            const nome = document.getElementById('nome').value;
                            const senha = document.getElementById('senha').value;

                            // Aqui você pode fazer algo com os valores digitados
                            console.log('Nome:', nome);
                            console.log('Senha:', senha);
                        }
                        });
                        if(adm == 1){
                            document.getElementById("administrador").checked=true;
                        }else
                            document.getElementById("administrador").disabled=true;


                }
                function usuarioExistente(){
                    Swal.fire({
                        title: 'Usuário já está cadastrado com essa opção',
                        icon: 'warning',
                        showConfirmButton: false,
                        timer: 3000
                    });
                }

        }
</script>
</body>
</html>
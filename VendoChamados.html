<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Filtro de Chamados</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="/siasb_html/flowSite/verificaSessao.js"></script>

    <style>
        /* Estilos para o formulário */

        .top-div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        #myIframe {
            width: 100%;
        }

        .logo {
            position: absolute;
            width: 40px;
            height: 40px;
            left: 40px;
            margin: 0 auto;
            background-color: #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            top: 30px;
        }

        .logo img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 6px;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            /* max-width: 30%; */
            width: 200px;
            height: 70px;
            background-color: white;
            margin-top: 50px;
            margin-bottom: 50px;
            border-radius: 5px;

        }

        form {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        }

        h2 {
            width: 100%;
            text-align: center;
            font-family: 'Gill Sans', 'Gill Sans MT', 'Calibri', 'Trebuchet MS', sans-serif;
            color: rgb(0, 0, 181);


        }

        .form-group {
            flex-basis: 45%;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        select {
            width: 80px;
            padding: 10px;
            padding-left: 10px;
            padding-right: 30px;
            border-radius: 3px;
            border: 1px solid #ccc;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #0031e3;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .resultados {
            display: flex;
            margin-top: 20px;
            background-color: #ffffff;
            color: black;
            padding: 10px;
            border-radius: 5px;
        }

        .MeusCampos {
            padding-left: 0px;
            margin-right: 30px;
            padding-top: 10px;
        }

        .FaixaForm {
            background-color: #0031e3;
            border-radius: 3px;
            display: flex;
            margin-bottom: 20px;
        }

        /* VOU UTILIZAR PARA A PARTE DE CIMA E PARA PARTE DE BAIXO */
        .CamposResultados {
            width: 100%;
            display: inline-block;
            color: #ffffff;
        }

        #temp {
            padding: 1px 20px;
            background-color: #0031e3;
            color: white;
            border-radius: 6px;
        }

        select {
            padding-left: 2px;
            width: fit-content;
        }

        .datas {
            width: 100px;
        }

        .bi {
            /* Icone*/
            font-size: 1.5em;
            padding-left: 10px;
            width: fit-content;
            margin-left: 10px;
        }

        a {
            text-decoration: none;
        }
    </style>
</head>

<body onload="init()">
    <div class="container">
        <div style="border-radius: 5px;" class="div-superior">
            <div style="border-radius: 10px;" class="logo"> <img
                    src="C:\Users\lucas\Downloads\pngtree-vector-notification-icon-png-image_855007.png"> </div>
            <h2 style="color: rgb(0, 0, 181); font-size: 21px;">ABRIR CHAMADO</h2>
            <button onclick="window.location.href = 'AbrindoChamado.html'">
                Novo Chamado
            </button>
            <!-- Conteúdo adicional da div superior -->
        </div>
    </div>
    <!-- <div class="container">

        <div class="container">

            <a href="FiltroChamados.html" id="temp">
                <p>Filtro Chamados</p>
            </a>
        </div>
        <div class="container">

            <a href="DetalhandoChamado.html" id="temp">
                <p>Detalhando chamado</p>
            </a>
        </div>
    </div> -->

    <form style="background-color: white; border-radius: 5px;" id="filtroForm">
        <h2>FILTRO DE CHAMADOS</h2>

        <div class="top-div">

            <div class="MeusCampos">
                <label for="codigoSolicitacao">Código:</label>
                <input type="text" id="codigoSolicitacao">
            </div>
            <div class="MeusCampos">
                <label for="data">Data</label>
                <select class="form-select" name="data" id="data" onchange="ateHoje()">
                    <option value="" selected hidden>Selecione a opção</option>
                    <option value="1">Abertura</option>
                    <option value="2">Fechamento</option>
                    <option value="3">Teste</option>
                </select>

            </div>
            <div class="MeusCampos datas">
                <label for=""> </label> <!-- deixei esse label vazio para nao desalinhar a data -->
                <input type="text" id="dataDe" class="datas" placeholder="De:" readonly>
            </div>
            <div class="MeusCampos datas">
                <label for=""> </label> <!-- deixei esse label vazio para nao desalinhar a data -->
                <input type="text" id="dataAte" class="datas" placeholder="Até:" readonly>

            </div>
            <div class="MeusCampos">
                <label for="status">Status:</label>
                <select id="status" name="status">
                    <option value="" selected hidden>Selecione...</option>
                    <option value="1">Aberto</option>
                    <!-- seria interessante essas informações partirem de um select nos status-->
                    <option value="2">Andamento</option>
                    <option value="3">Pendente</option>
                    <option value="4">Fechado</option>
                    <option value="5">TODOS</option>
                </select>
            </div>
        </div>

        <button type="submit">Filtrar</button>
    </form>

    <div class="resultados" id="resultadosContainer" style="display: none;">
        <div class="FaixaForm">
            <div class="CamposResultados">
                <p style="padding-left: 10px;"> ID da Solicitação </p>
            </div>
            <div class="CamposResultados">
                <p> Data de Abertura </p>
            </div>
            <div class="CamposResultados">
                <p> Assunto</p>
            </div>
            <div class="CamposResultados">
                <p> Status</p>
            </div>
            <!-- <div class="CamposResultados responsavel_tecnologia"> <p>Andamento</p> </div> -->
        </div>
        <div id="resultados">

            <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

            <script>
                flatpickr("#dataDe", {
                    dateFormat: "d/m/Y"
                });
                flatpickr("#dataAte", {
                    dateFormat: "d/m/Y"
                });
                const filtroForm = document.getElementById('filtroForm');
                const resultadosContainer = document.getElementById('resultadosContainer');
                const resultados = document.getElementById('resultados');

                function init() {
                    selectInicial();
                }

                function ateHoje() {
                    var selectData = document.getElementById("data");
                    var dataOption = selectData.options[selectData.selectedIndex].value;
                    if (dataOption == 3) {
                        dataDe.value = '01/01/2023';
                        var currentDate = new Date();
                        var day = currentDate.getDate();
                        var month = currentDate.getMonth() + 1; // Os meses começam em zero, então adicionamos 1
                        var year = currentDate.getFullYear();

                        // Formatar para "dd/mm/yyyy"
                        var dataAtual = ('0' + day).slice(-2) + '/' + ('0' + month).slice(-2) + '/' + year;

                        dataAte.value = dataAtual;
                    }
                }

                filtroForm.addEventListener('submit', function (event) {
                    event.preventDefault();

                    // Lógica de filtragem aqui

                    var selectData = document.getElementById("data");
                    var dataOption = selectData.options[selectData.selectedIndex].value;
                    var dataDe = document.getElementById("dataDe").value;
                    var dataAte = document.getElementById("dataAte").value;

                    const codigoSolicitacao = document.getElementById('codigoSolicitacao').value;
                    const status = document.getElementById('status').value;

                    // Exemplo: exibir resultados em um elemento de texto
                    // resultados.innerHTML = `Filtrando por:<br>Código da Solicitação: ${codigoSolicitacao}<br>Opção data: ${dataOption}<br>Data de:${dataDe}<br>Data até:${dataAte}<br>Status: ${status}<br>`;


                    var data = "Select=" + 1 +
                        "&dataOption=" + encodeURIComponent(dataOption) +
                        "&dataDe=" + encodeURIComponent(dataDe) +
                        "&dataAte=" + encodeURIComponent(dataAte) +
                        "&codigoSolicitacao=" + encodeURIComponent(codigoSolicitacao) +
                        "&status=" + encodeURIComponent(status);
                    xhrRequest(data, resultados);
                });

                function detalharChamado(IDChamado) {
                    pai = IDChamado.parentNode;
                    pai = pai.parentNode;
                    id = pai.querySelector("#IDChamado");
                    id = id.querySelector("p").textContent;

                    window.location.href = 'DetalhandoChamado.html?IDChamado=' + id;
                }

                function selectInicial() {
                    var currentDate = new Date();
                    var day = currentDate.getDate();
                    var month = currentDate.getMonth() + 1; // Os meses começam em zero, então adicionamos 1
                    var year = currentDate.getFullYear();
                    // Formatar para "dd/mm/yyyy"
                    var dataAtual = ('0' + day).slice(-2) + '/' + ('0' + month).slice(-2) + '/' + year;
                    var dataAte = dataAtual;
                    var data = "Select=" + 1 +
                        "&dataOption=" + encodeURIComponent('1') +
                        "&dataDe=" + encodeURIComponent('01/01/2023') +
                        "&dataAte=" + encodeURIComponent(dataAte) +
                        "&codigoSolicitacao=" + encodeURIComponent('') +
                        "&status=" + encodeURIComponent('inicial');

                    xhrRequest(data, resultados);
                }



                function xhrRequest(data, output) {
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "VendoChamados.php", true);
                    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            if (output.id == 'resultados') {
                                output.innerHTML = xhr.responseText;
                            } else
                                if (output == 'verificarSetor') {
                                    //se a resposta for 1, é setor tecnologia
                                    if (xhr.responseText == 1) {
                                        controlarChamados();
                                    }
                                }
                        }
                    };
                    xhr.send(data);

                    resultadosContainer.style.display = 'block';
                }

            </script>
</body>

</html>